<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CONTROL DE ASISTENCIA - ESTUDIANTES</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body class="bg-gradient-to-b from-yellow-100 via-yellow-50 to-blue-100 min-h-screen p-4">

  <div class="max-w-4xl mx-auto bg-white shadow-2xl rounded-2xl p-6">
  <header class="mb-12 text-gray-800 flex flex-col md:flex-row items-center justify-center md:justify-start">
    <img  src="sello.jpg" alt="Sello de la Unidad Educativa Dr. Camilo Gallegos Dom√≠nguez"
      class="h-20 w-20 md:h-24 md:w-24 mb-4 md:mb-0 md:mr-6 rounded-full shadow-md object-cover flex-shrink-0"
      onerror="this.onerror=null; this.src='https://placehold.co/100x100/EBF4FF/3B82F6?text=Sello';"    >

    <div class="text-center md:text-left">
      <h1 class="text-center text-xl md:text-2xl font-bold mb-2 text-blue-700 drop-shadow">
          UNIDAD EDUCATIVA "DR. CAMILO GALLEGOS DOM√çNGUEZ"
      </h1>
      <h2 class="text-center text-lg md:text-xl font-semibold mb-1 text-blue-300 drop-shadow">
        Tercero Inform√°tica Paralelo:"B"
      </h2>
      <p class="text-center text-lg md:text-xl font-semibold mb-1 text-blue-300 drop-shadow">
        Tutora: Mgs. Maricela Cun Rueda
      </p>
    </div>
  </header>

    <h1 class="text-3xl font-bold text-blue-700 text-center mb-6">üìã CONTROL DE ASISTENCIA - ESTUDIANTES</h1>

    <form id="formulario" class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div>
        <label class="block text-blue-700 font-semibold mb-1">Fecha:</label>
        <input type="date" id="fecha" class="w-full border border-blue-300 rounded p-2" required>
      </div>

      <div>
        <label class="block text-blue-700 font-semibold mb-1">Curso:</label>
        <select id="curso" class="w-full border border-blue-300 rounded p-2" required>
          <option value="">Selecciona un curso</option>
          <option value="3ro Infor A">3ro Infor A</option>
          <option value="3ro Infor B">3ro Infor B</option>
        </select>
      </div>

      <div>
        <label class="block text-blue-700 font-semibold mb-1">Nombre del Estudiante:</label>
        <select id="nombre" class="w-full border border-blue-300 rounded p-2" required disabled>
            <option value="">Selecciona un curso primero</option>
        </select>
      </div>

      <div>
        <label class="block text-blue-700 font-semibold mb-1">Estado:</label>
        <select id="estado" class="w-full border border-blue-300 rounded p-2" required>
          <option value="">Selecciona estado</option>
          <option>Atrasado</option>
          <option>Ausente</option>
          <option>Justificado</option>
          <option>Presente</option> </select>
      </div>

      <div class="col-span-1 md:col-span-2">
        <label class="block text-blue-700 font-semibold mb-1">Observaciones:</label>
        <textarea id="observaciones" placeholder="Escribe una observaci√≥n aqu√≠..." class="w-full border border-blue-300 rounded p-2"></textarea>
      </div>

      <div class="col-span-1 md:col-span-2 flex justify-center mt-4">
        <button type="submit" class="bg-gradient-to-r from-yellow-400 to-blue-500 hover:from-yellow-300 hover:to-blue-600 text-white font-bold px-6 py-2 rounded-lg shadow-md">
          Registrar Asistencia
        </button>
      </div>
    </form>

    <div class="mt-6">
      <input type="text" id="buscador" placeholder="üîç Buscar estudiante..." onkeyup="filtrarTabla()" class="w-full border border-yellow-400 rounded p-2">
    </div>

    <div class="overflow-x-auto mt-6 rounded-lg">
      <table class="min-w-full bg-white border border-blue-300 text-center">
        <thead class="bg-gradient-to-r from-blue-600 to-yellow-400 text-white font-semibold">
          <tr>
            <th class="py-2 px-4 border">Fecha</th>
            <th class="py-2 px-4 border">Curso</th>
            <th class="py-2 px-4 border">Nombre</th>
            <th class="py-2 px-4 border">Estado</th>
            <th class="py-2 px-4 border">Observaciones</th>
          </tr>
        </thead>
        <tbody id="tabla-asistencia" class="text-gray-700"></tbody>
      </table>
    </div>

    <div class="flex justify-end mt-4 space-x-2 flex-wrap">
      <button onclick="exportarCSV()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded shadow mb-2 md:mb-0">
        üíæ Exportar CSV
      </button>
      <button onclick="exportarPDF()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded shadow mb-2 md:mb-0">
        üìÑ Exportar PDF
      </button>
      <button onclick="limpiarRegistrosDelDia()" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded shadow">
        üßπ Limpiar Registros del D√≠a
      </button>
    </div>
  </div>

  <script>
    const formulario = document.getElementById("formulario");
    const tabla = document.getElementById("tabla-asistencia");
    const buscador = document.getElementById("buscador");
    const selectCurso = document.getElementById("curso");
    const selectNombre = document.getElementById("nombre");
    let registros = JSON.parse(localStorage.getItem("asistencias")) || [];

    // N√≥minas de estudiantes
    const nominas = {
        "3ro Infor A": [
            "AGREDA BONILLA ALBANO EMANUELE PIERLUIGI",
            "AGUIRRE GOMEZ STALIN JAIR",
            "AVILA MONTESDEOCA JOHNSON LEE",
            "BONE VALENCIA NOELIA DAMARIS",
            "CABRERA POGGIO JULIO XAVIER",
            "CAPELO ROMERO JORGE REYNALDO",
            "CARRILLO ESPINOZA DIEGO LEONARDO",
            "CUN CHICOMA JORGE JOSUE",
            "ESPINOZA CASTILLO JEFFERSON ROLANDO",
            "GONZALES VALAREZO XIMENA ALEJANDRA",
            "GONZALEZ CHERREZ MICHAEL DANIEL",
            "GUAMAN SURIAGA ALEX DANILO",
            "GUERRERO NARANJO JOEL ROGER",
            "HERRERA FEIJOO MATEO SEBASTIAN",
            "HERRERA PIEDRA STEFANY ANDREA",
            "HIDALGO CUEVA OSCAR ALEXANDER",
            "HOLGUIN DELGADO DENISSE ABIGAIL",
            "JIMENEZ ABAD LUIS FERNANDO",
            "MERECI VERA DANNA CAMILA",
            "PONCE BUSTAMANTE JEAMPIERRE",
            "RAMIREZ ASENCIO SLEIDER JAVIER",
            "ROBLES ZAPATA JESUS ADRIAN",
            "RODRIGUEZ GUARNIZO RAFAEL ALBERTO",
            "ROMERO ERRAEZ NAHOMY LISSBETH",
            "RUIZ SANCHEZ YASMIN JUSLEIDY",
            "TENEMAZA GUARTAN RODDY LENIN",
            "VIVANCO GRANDA ANTHONY JAIR",
            "ZAPATA LUCERO JAIR ALEXANDER",
            "ZUMBA ESPINOZA LUIS FERNANDO"
        ].sort(), // Ordenar alfab√©ticamente
        "3ro Infor B": [
            "AGILA GUTIERREZ BRITTANY PAOLA",
            "CAJAMARCA PE√ëAFIEL DARWIN ALEXANDER",
            "CAMACHO RODRIGUEZ LUZ MARIA",
            "CASTILLO SARITAMA LUIS ALEXANDER",
            "CRUZ VELASCO STEFANIE YULIANA",
            "CUENCA CALVA YUSELLY DAYANNA",
            "ESPINOZA AREVALO ERICKA DAYANNA",
            "GUARNIZO SARANGO XIOMARA PAULETTE",
            "GUTIERREZ RAMON AXEL XAVIER",
            "JARAMILLO MORALES XIMENA KAROLINA",
            "JUMBO SARANGO JEFFERSON VICENTE",
            "LIANG FAREZ BAO YU",
            "MANZANO RAMIREZ GABRIELA ALEXANDRA",
            "MASAPANTA FLORES VICTOR MANUEL",
            "MAZA CHUYA EMILY GABRIELA",
            "MEDINA SANCHEZ CRISTOPHER ADRIAN",
            "MENDOZA MANZANO KEVIN MANUEL",
            "MOROCHO VILLALTA ESTEFANY MARIBEL",
            "MOROCHO VILLALTA JOSE ALEXANDER",
            "NAZARENO NAZARENO ALEXANDRA NOEMI",
            "ORDO√ëEZ BELTRAN ANGELA EUNICE",
            "ORELLANA NOBLECILLA JEINER JAIR",
            "REYES BEDOYA MARIA ISABEL",
            "RODRIGUEZ ROMERO ELVIS DANIEL",
            "ROMERO JIMENEZ GRACIELA MERCEDES",
            "SANCHEZ ORDO√ëEZ FELIX ADOLFO",
            "SARANGO NARVAEZ DILAN JOSUE",
            "SOTO PUCHA ESNEIDER ANDRES",
            "VINCES BRAVO ARIEL ENRIQUE",
            "VIVANCO GRANDA ANTHONY JAIR"
        ].sort() // Ordenar alfab√©ticamente
    };

    // Funci√≥n para llenar el select de nombres seg√∫n el curso seleccionado
    function llenarNombres() {
        const cursoSeleccionado = selectCurso.value;
        selectNombre.innerHTML = ""; // Limpiar opciones actuales
        selectNombre.disabled = true; // Deshabilitar hasta que se seleccione un curso

        if (cursoSeleccionado && nominas[cursoSeleccionado]) {
            selectNombre.disabled = false; // Habilitar si hay un curso seleccionado
            const optionDefault = document.createElement("option");
            optionDefault.value = "";
            optionDefault.textContent = "Selecciona un estudiante";
            selectNombre.appendChild(optionDefault);

            nominas[cursoSeleccionado].forEach(nombre => {
                const option = document.createElement("option");
                option.value = nombre;
                option.textContent = nombre;
                selectNombre.appendChild(option);
            });
        } else {
             const optionDefault = document.createElement("option");
            optionDefault.value = "";
            optionDefault.textContent = "Selecciona un curso primero";
            selectNombre.appendChild(optionDefault);
        }
    }

    // Event listener para el cambio en el select de curso
    selectCurso.addEventListener("change", llenarNombres);

    formulario.addEventListener("submit", function (e) {
      e.preventDefault();

      const fecha = document.getElementById("fecha").value;
      const curso = selectCurso.value; // Obtener valor del select de curso
      const nombre = selectNombre.value; // Obtener valor del select de nombre
      const estado = document.getElementById("estado").value;
      const observaciones = document.getElementById("observaciones").value.trim();

      if (!fecha || !curso || !nombre || !estado) {
        alert("Por favor, completa todos los campos.");
        return;
      }

      // La validaci√≥n de nombre solo con letras ya no es necesaria si se selecciona de una lista predefinida

      const hoy = new Date().toISOString().split("T")[0];
      if (fecha > hoy) {
        alert("La fecha no puede estar en el futuro.");
        return;
      }

      const yaExiste = registros.some(r =>
        r.fecha === fecha && r.curso === curso && r.nombre.toLowerCase() === nombre.toLowerCase()
      );

      if (yaExiste) {
        alert("Ya se registr√≥ este estudiante para esta fecha y curso.");
        return;
      }

      const nuevoRegistro = { fecha, curso, nombre, estado, observaciones };
      registros.push(nuevoRegistro);
      localStorage.setItem("asistencias", JSON.stringify(registros));
      formulario.reset();
      // Restablecer el select de nombres despu√©s de resetear el formulario
      llenarNombres();
      mostrarRegistros();
    });

    function mostrarRegistros() {
      tabla.innerHTML = "";
      const registrosOrdenados = [...registros].sort((a, b) => new Date(b.fecha) - new Date(a.fecha));

      registrosOrdenados.forEach(reg => {
        const fila = document.createElement("tr");
        fila.innerHTML = `
          <td class="border px-4 py-2">${reg.fecha}</td>
          <td class="border px-4 py-2">${reg.curso}</td>
          <td class="border px-4 py-2">${reg.nombre}</td>
          <td class="border px-4 py-2">${reg.estado}</td>
          <td class="border px-4 py-2">${reg.observaciones}</td>
        `;
        tabla.appendChild(fila);
      });
    }

    function filtrarTabla() {
      const filtro = buscador.value.toLowerCase();
      const filas = tabla.getElementsByTagName("tr");
      Array.from(filas).forEach(fila => {
        const texto = fila.textContent.toLowerCase();
        fila.style.display = texto.includes(filtro) ? "" : "none";
      });
    }

    function exportarCSV() {
      let csv = "Fecha,Curso,Nombre,Estado,Observaciones\n";
      registros.forEach(r => {
        const observacionesSeguras = r.observaciones.replace(/"/g, '""');
        csv += `"${r.fecha}","${r.curso}","${r.nombre}","${r.estado}","${observacionesSeguras}"\n`;
      });
      const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.setAttribute("href", url);
      a.setAttribute("download", "asistencia-estudiantes.csv");
      a.click();
    }

    function exportarPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      doc.setFont("helvetica", "normal");
      doc.setFontSize(10);

      let yPosition = 20;
      const margin = 15;
      const pageWidth = doc.internal.pageSize.getWidth();

      doc.setFontSize(14);
      doc.text("Control de Asistencia - Estudiantes", pageWidth / 2, yPosition, { align: 'center' });
      yPosition += 10;
      doc.setFontSize(10);

      registros.forEach(r => {
        const line = `Fecha: ${r.fecha} | Curso: ${r.curso} | Nombre: ${r.nombre} | Estado: ${r.estado} | Observaciones: ${r.observaciones}`;
        const splitText = doc.splitTextToSize(line, pageWidth - 2 * margin);
        doc.text(splitText, margin, yPosition);
        yPosition += (splitText.length * 4) + 2;

        if (yPosition > doc.internal.pageSize.getHeight() - margin) {
            doc.addPage();
            yPosition = margin;
            doc.setFontSize(14);
            doc.text("Control de Asistencia - Estudiantes (Continuaci√≥n)", pageWidth / 2, yPosition, { align: 'center' });
            yPosition += 10;
            doc.setFontSize(10);
        }
      });

      doc.save("asistencia-estudiantes.pdf");
    }

    function limpiarRegistrosDelDia() {
        const hoy = new Date().toISOString().split("T")[0];

        if (confirm(`¬øEst√°s seguro de que quieres limpiar TODOS los registros de asistencia para la fecha ${hoy}? Esta acci√≥n no se puede deshacer.`)) {
            const registrosFiltrados = registros.filter(reg => reg.fecha !== hoy);
            registros = registrosFiltrados;
            localStorage.setItem("asistencias", JSON.stringify(registros));
            mostrarRegistros();
            alert(`Registros de la fecha ${hoy} limpiados correctamente.`);
        } else {
            alert("La limpieza de registros ha sido cancelada.");
        }
    }

    function setFechaActual() {
        const fechaInput = document.getElementById("fecha");
        const hoy = new Date().toISOString().split("T")[0];
        fechaInput.value = hoy;
    }

    // Inicializar la fecha, llenar los nombres (inicialmente vac√≠o o con mensaje) y mostrar registros al cargar la p√°gina
    setFechaActual();
    llenarNombres(); // Llama a llenarNombres al cargar para mostrar el mensaje inicial
    mostrarRegistros();

  </script>
  <a href="index.html" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded mt-4 inline-block">INICIO</a>
</body>
</html>
